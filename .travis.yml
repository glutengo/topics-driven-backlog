language: generic
sudo: required
services:
- docker
addons:
  ssh_known_hosts:
  - backlog-staging.f4.htw-berlin.de
  - 141.45.146.76
env:
  global:
  - APPLICATION_ENVIRONMENT=docker
  # DOCKER_USERNAME
  - secure: wNNrboqc75TZuEnL0JfLzMaApL9V/ul4c4zig3goR9+8Ud0feGmF5wNNVWg58IsVw+QOVp0Vt50Q877VdWWxialft2JP6TMorIjBNhQ3+mBx2K5FdG+VBYWPLXBbIplJTG/3tfD6hvi1xl0J8VGQiVIOhkqK0BGPDZ/iK20tBW/R3r9wkgvqzg4otBeRFYqW6A2No5f1jzHAZ+DtJnwOSFZ4Lzp4gsIov7/+VSOi9gux4X8W3MsvKwIftMP0IT2qYqNVTWjmTVXQc5Zj5lPIQqcb5mC1iytQhkoTtpYBgclYd4tsRvbjgDOM5sA1+vqlOgYeXy2Uc6/3js6AE6DB6QFeuTGvol/sG9H82OYZMAt8aMkDL97MUtbaDJyBQnsoxG4aaoQLaSBFx/CR0o1Zr40yifcHQZHyygDklxiLAEW5RrG2uaMTWc999TmvEFmr5QBSfuUhAzWsKRmnZJ/kjo/NDTy6/rKyhc1mCaxJNHU51CdciFNP9seA3rJbcAjyDIJTCbs8e2nwzybiKWjHoTDnMjOJhV5e5OcynGaUmkSQABMyvzPtzTm2AlV6+cK4t9LgEsHZdWf8/VNcA+ITA00MfnX3/t9v4+DHC6t3SQFT5dC89QXDW2tFPZbnWzJtxPcjSGxFUWt11o9LSFigyUrJ9Co7INiEhxtGoxQslss=
  # DOCKER_PASSWORD
  - secure: jwc4wbqo6T8vqS+5T+qNxYLIulqVtp+4sotALcbSTT6vDGupfBqnzJ43dRaqmOL+HB+yEMxBOky2MofLFXN2fG/61I4QNlorfojAvDTLQXhJw+sX1LgO3Hs4mr4EChSXI/r4R+ZuP0a/fm+lrEXw7C+DrJEMWkj+K4J4Dcz1b+f/JLvr3iwNN/Xb9GuzDygT7z15Ir+XU9lch/fHXFNtkRmIHVtsPLIXxhj4173W2kaaS/E9NQNW6MBKtVUvP+l9InkbRAEeWoRyS3lLXznsKWYoBhhN/U4t5k6Ry9CJonkncjUyZGOu9KVCCT6+B62qfPFJVP9A+cy3dR+zlzI9lxqnhlB3STJSGaw62IzbOeHItuYSObG0lwDxyQ9jR75yXk1feikRsmeDIS+IfQSQq8y8bzcMzYONpztc/uuKy/Lqg8ISO9kSYCVzwBuNcbWzRE1nhpzN4GH4SlNWDfG8KvCWCWYtd0JK9gJ4tcC5SaTNQE8ISYUOJbfybGuLggfTru4PPIkNOGynShWZRy9fgDQGkMYmwlh5Cg5fyykaxzL5Qo9Xv4NVtCtizJKKe3cDGQSstdQcodbPKROgFzRzdGiCT50PgPSdILAkI4vLai+7bwPzlEEBpRCTA+GxWLqVzi7Y0IihID5A2WSwhruQthdMD/HCJHWvxYURljHYaGA=
  # SECRET_KEY_BASE
  - secure: Budja+a5FFjIfLeX0cZ4dMkze+yhN3t/L4lYNQFfA5zgrpknEGwOpoMc4j89JxzwrrERSB53yLTUWukQ8q7XmlmpG8xG9ye3a86tu0z+GMiYlT3jy+T9xCu7BNkNX9WGUyFgvycGuePX5rdDxfAAKiXjAcppYWDktBp50lXIPewJtnCZQh8MVpWB4efHo87W5dUjve2y39isiTBaRobszfIcZDe7Ql6aH/F1lxs00pciEAYj+rFzAUjGTnMyTb93S6IVT+Svi2ELzSYHNmybrfeAGQWQiEeZHQDN48ot6InjTUD/ZbmZRB7PRBKjxa1oYKtK7EheeK7P4HA5nB4aliAu62k/iNNIob3r7IT+YokVym+DUVoTQ16M5ialVhntkC1Y9/STYgUrfKr47oUGQodvuQeBLUoMbbR2stccDr6AEaqYO2DkDFTgy27Bal5N6l0ykCDYKqmI6l7V7xW0YMtDUkSKq1biMRlu0Hqo657DMk8u3TUz8cDAEJUlw0cZhW58+z4amFRHBnVU4UFd1TxHxUAaQRPkBhybOcdhxKRI5sC6YEJfuzkgiDlTn4ZCzd5Mu8iBBmEjzyBPV1BAVbAQKsIC3LDK1A5ovajy+bzKtKoE8lLeP9/bP+LJwdbEvzfcNuU9qeY9dkfhQ9EkaSrl/IgdqaQA8ryJeYlwvjA=
  # LDAP_CONNECTSTRING
  - secure: n7FQomw8G3+S20Ertv4XniIUutzb36ag8BgyqFGy1Qq3kaRKh74SxahcIZgo3KL7uvCELcTrG7dOBIXAzo5iQM9Q1Dssp/qjeGXIB0EVUEFh03CLcgaGSZ0AAgVSGrLJaRDX6f9RbZr1psLkG4ibFIksVxguSc+BkQ37MKmousTl9bJxJCZ1oNXXp9oCoc2X+NGlCKqtmOrBoJxw+3Uup8t08uy+Yqldt6C8sShjvXvwkh/D4fV/sT5OgGnT/Wq8lvO3BvTK84/Iu+AGyRpzbxbKCcnsT5OlWsm6fdPm1YUxG7T0hLgKv9+lrV9dMMwTfacQMsA17v4JkGRyFQsbLOWEGYtwFxmRHwIBRD3NLICpkVGZXoD4tdPq5GIV1+rtxcGN63cjOGDpbOExv0LXK6FMHQVh77df7d70V4jlBrX6IQzyVPePcwEFqbeQz0ZzD+UTzNb6d6kgOYJ2xLY1nCGZ4pD/gSj/qMyhuGHMfgLW9dkIQ+Qn/y4TNicLXk9sgVNKmCITXbwJ144GffIG6X2A/Ml7e03RXgyxvW/Buo8OOyEkraO/KE0f8ZP15Krhf9OKFbUOPg909oucr2sOoA2vcnZzguC6eMqZWApUTzvAsADocYDAI0JdfKoW53jqzWOCAj74bEunMu8qSMwFSO9OcaV1PALgPg2bT0Y+VPk=
  # LDAP_PORT
  - secure: IaN66Rh7AcShOzGiFizGvuiHHNtu7YR3d3WDKcRAe64OJxRVFvkixyT/BVflAR8urr6b104gjd+KMrKI7hjiiWeCBOoiBhx4MKZXSrKNtHDUNe8TcqhpIV17VPGBbCPsT6e5r7GNCzIJF2YgW/H2hX7t7hLSEg4QT6LU+YtQ8y3p6fQvYniqJCeY7lIMIXMcP8qp1lnhGcg6lvgsqM9GX70ZHq2mj8S2rBYjqUlCx4LS/zq+vmb5mZxW8Rj+JTyctG4xQZJQ6DVfIQeoTRwC3a332kD7UhRIrGcWE7p27dfbb9h8z7VzweKOH7KH1epFzWong24GO1h659SDtTEG+ju5uSxNb0ekO8rxfYkoI3xO+zLU1wl2iIDVo9Nij8H7bz0RyPTreikcvbigbWi1n3bMxGDD1i0NA2fs5TerJcxcCfEu0dMxVUli0yLLXNHFEJRQnbzcs7lyNWpklbX+cvWQvutvDN8yyB00tDJjU6e5/ws3iBo5wpbVnNTEIszWBkYNvarHjEPE7ncWR0WlhAoefN6Mt7k4kpnBvhwhWWPJRnpYe/ZV6CQFpQ9PN//yhm9l+GZQIPS2nvMYI7uPNXd1PyG5YNJRaSRyTlIfvt3hpX6GspMTfIxHkvOMf9VfMTILKg9BNqw0rkHdXdWHwfmPB/G2/A7YRMl9x4XxAl0=
  # LDAP_HOST
  - secure: P6hQvwQ1apeYDaqH29Icv0q3pzm8JNOoyJME4eM/4Rxn5jvbhXqbXJOWVVMCaGxD6gnYqpt6o+J4y1DSgdEGc6GAFFlj+nVg5tWYGrvbIU/eXfaftp06Wc/7uo/sAn7kKgbx+v3y+oy7uzyanzN0WVJa1B/hnjICkotof/QLuCxGPlwNF/fUokK8H2wUP7cKl3SEy5DJRrX/0oynVGEF5teLa7b8brye76irpkoa64I4YuokAbHemg8unECNR5SyTrWrl0T/16CjotDR9npw2xCxb35osr/B544WckpUjBt/bSxA6z6Ag9l35EU2LyX7zIXXVekHuTGidzwEx4+psizEX9vqEujbue/dg5YVWuuP3Zp7mOdieb26gfkVo+CsRdl+dBtOrgkUChrMZyYNFe5AOV7xr3iVmTt0yIh/i4Qhah9vF3mLYq7KX6QPJtFCwNPTNu9Z9A/POxfEcCIh9wEOH6SFCtHH5NGFTgHZFh4deyrmeG3YM98thy0Hr5ZsP2d2TvE+fwqP3fygrP59FBQQEP0xq1g31K7+6ueMLc2cxbQ6XNOo+4c7/g8B6OZUbWRXJDjNuX0N/B7ORZpMc+E1kzZFBcLMT+GYsqjkgY6sU9tpzZV7SvX/2qOp4ViZEkeKlxaAAL2KLiHTWSA0vBZgpd6O6SJlYf+pXKaUk3A=
jobs:
  include:
    - stage: test
      script: ".travis/01-test.sh"
    - stage: build
      script: ".travis/02-build-and-push-image.sh"
      if: (branch = develop) AND (NOT (type = pull_request))
    - stage: deploy
      script: ".travis/03-deploy.sh staging"
      if: (branch = develop) AND (NOT (type = pull_request))