language: generic
sudo: required
services:
- docker
addons:
  ssh_known_hosts:
  - backlog-staging.f4.htw-berlin.de
  - 141.45.146.76
env:
  global:
  - APPLICATION_ENVIRONMENT=docker
  # DOCKER_USERNAME
  - secure: wNNrboqc75TZuEnL0JfLzMaApL9V/ul4c4zig3goR9+8Ud0feGmF5wNNVWg58IsVw+QOVp0Vt50Q877VdWWxialft2JP6TMorIjBNhQ3+mBx2K5FdG+VBYWPLXBbIplJTG/3tfD6hvi1xl0J8VGQiVIOhkqK0BGPDZ/iK20tBW/R3r9wkgvqzg4otBeRFYqW6A2No5f1jzHAZ+DtJnwOSFZ4Lzp4gsIov7/+VSOi9gux4X8W3MsvKwIftMP0IT2qYqNVTWjmTVXQc5Zj5lPIQqcb5mC1iytQhkoTtpYBgclYd4tsRvbjgDOM5sA1+vqlOgYeXy2Uc6/3js6AE6DB6QFeuTGvol/sG9H82OYZMAt8aMkDL97MUtbaDJyBQnsoxG4aaoQLaSBFx/CR0o1Zr40yifcHQZHyygDklxiLAEW5RrG2uaMTWc999TmvEFmr5QBSfuUhAzWsKRmnZJ/kjo/NDTy6/rKyhc1mCaxJNHU51CdciFNP9seA3rJbcAjyDIJTCbs8e2nwzybiKWjHoTDnMjOJhV5e5OcynGaUmkSQABMyvzPtzTm2AlV6+cK4t9LgEsHZdWf8/VNcA+ITA00MfnX3/t9v4+DHC6t3SQFT5dC89QXDW2tFPZbnWzJtxPcjSGxFUWt11o9LSFigyUrJ9Co7INiEhxtGoxQslss=
  # DOCKER_PASSWORD
  - secure: jwc4wbqo6T8vqS+5T+qNxYLIulqVtp+4sotALcbSTT6vDGupfBqnzJ43dRaqmOL+HB+yEMxBOky2MofLFXN2fG/61I4QNlorfojAvDTLQXhJw+sX1LgO3Hs4mr4EChSXI/r4R+ZuP0a/fm+lrEXw7C+DrJEMWkj+K4J4Dcz1b+f/JLvr3iwNN/Xb9GuzDygT7z15Ir+XU9lch/fHXFNtkRmIHVtsPLIXxhj4173W2kaaS/E9NQNW6MBKtVUvP+l9InkbRAEeWoRyS3lLXznsKWYoBhhN/U4t5k6Ry9CJonkncjUyZGOu9KVCCT6+B62qfPFJVP9A+cy3dR+zlzI9lxqnhlB3STJSGaw62IzbOeHItuYSObG0lwDxyQ9jR75yXk1feikRsmeDIS+IfQSQq8y8bzcMzYONpztc/uuKy/Lqg8ISO9kSYCVzwBuNcbWzRE1nhpzN4GH4SlNWDfG8KvCWCWYtd0JK9gJ4tcC5SaTNQE8ISYUOJbfybGuLggfTru4PPIkNOGynShWZRy9fgDQGkMYmwlh5Cg5fyykaxzL5Qo9Xv4NVtCtizJKKe3cDGQSstdQcodbPKROgFzRzdGiCT50PgPSdILAkI4vLai+7bwPzlEEBpRCTA+GxWLqVzi7Y0IihID5A2WSwhruQthdMD/HCJHWvxYURljHYaGA=
  # SECRET_KEY_BASE
  - secure: Budja+a5FFjIfLeX0cZ4dMkze+yhN3t/L4lYNQFfA5zgrpknEGwOpoMc4j89JxzwrrERSB53yLTUWukQ8q7XmlmpG8xG9ye3a86tu0z+GMiYlT3jy+T9xCu7BNkNX9WGUyFgvycGuePX5rdDxfAAKiXjAcppYWDktBp50lXIPewJtnCZQh8MVpWB4efHo87W5dUjve2y39isiTBaRobszfIcZDe7Ql6aH/F1lxs00pciEAYj+rFzAUjGTnMyTb93S6IVT+Svi2ELzSYHNmybrfeAGQWQiEeZHQDN48ot6InjTUD/ZbmZRB7PRBKjxa1oYKtK7EheeK7P4HA5nB4aliAu62k/iNNIob3r7IT+YokVym+DUVoTQ16M5ialVhntkC1Y9/STYgUrfKr47oUGQodvuQeBLUoMbbR2stccDr6AEaqYO2DkDFTgy27Bal5N6l0ykCDYKqmI6l7V7xW0YMtDUkSKq1biMRlu0Hqo657DMk8u3TUz8cDAEJUlw0cZhW58+z4amFRHBnVU4UFd1TxHxUAaQRPkBhybOcdhxKRI5sC6YEJfuzkgiDlTn4ZCzd5Mu8iBBmEjzyBPV1BAVbAQKsIC3LDK1A5ovajy+bzKtKoE8lLeP9/bP+LJwdbEvzfcNuU9qeY9dkfhQ9EkaSrl/IgdqaQA8ryJeYlwvjA=
  # LDAP_CONNECTSTRING
  - secure: Ib+rjkaFeIJAsBKnaoaT0+OUk7yGIve/noF4eKudJKUZIN4YMm2MKONoj4yu5KU0m+cKjbWYQ9PMfxSgeIac8bysGVnSj2xP3dM2AbPlPgURScpn2K8sCG2gbsnUZH3ereBywEgJN4VLWtoCued6c6mFgjPbSPwUgOavrdn9N5JSxcyTVKmi7Id9ID/PqZwAVy9ZZkOkyXuBvrWgDRGPnes2yDnSQaSngLcQzIkFU8ZLqho6JCymfBSNmrt5BlHtrioy5vOIJlfvzJlR4Oq78a5eNsad5gASqQsuB9crsderYsDC5mrm5oHj811xr+I0cncFcYI5JKMG0oQeNe5e2C35N4VSCYJ662yKQwNhruFUAkQg2FIli1l05Y3PSFuulN7OV9okLC9Ew4YoR6q/oobM7pjXrjqKhKR2e8P6WP2pcC6dpYLRzcx1tO6utv+CmEKUCzUk0XQlTtcp2JW8MFqu8cxeQ8vqyzIwyJ3yM8F7igltOKCtsbQbgI5Jhp3LYXXWNGVpxU8HDuOmaeG9vsUsIL8LJAGrNbWNIw2mjMq3XWp04cmrHTPXdKcC6wC7urcVKu2xnhIad6qBy7icmC9kAreeAr+LpWwzLqZnF4ORcBwlJXJt/6J1Yd5ABaQ/5Z0ILKqbTROCjmvW3vXyoZU4iEZptSQeN93xY1fOpnU=
  # LDAP_HOST
  - secure: YxK//PGRiZA/Z9Pl22TMrXYgu6WVu5Gqm1YoXQtgyowOYJ+WX/CI9HRYDqoImkCHWVsAD+ATJI4Z9ruuKSzhR3EFToLyZwJ+5kU+LI8WJwIzRFEu8KGgQQBsSPqdUbygytDIB1xnlGLYyOYFmu2HlvffwMoB4pYN9S8gwl1KBSJMfts12xQuD165u2YUhjNtooSv5KN0GoytOqSbiIC5VpnRVAEuAXR2fYaTbek6CfHq4kV3JDB9dapcUd3BryJ3G7AaS/SCX7rFsqKuiKkwC6CYyJAmUub+GLbmnsbNkyOhiU9vMFHaKOI/I9RCT1PuEZAOe2Rt5QMfcpApjdnObBKQYJzWxleTOz7/9JgcsPGBUq+sRBtqciaC8F+UbZMW/vATuK/6G6D1E67tf0ZgUG5DyMUzdCL07UPgLtPSA/NvNydYjm2JRbfa8sSF7fy5QIpvuaJWl2YDcRj/rXXQm1CLuu4h31bE7WtRfw9CKkvhFDsO2QvuT3Jgjz5X3Otv63ezOPdNpyMPAp4xJmqfgPsrXCglYwURCaCcsi1hinQM7MUkRtALYowv7JYz/ZSxjqUw3/HcD3Uqg75S/PI26pZ2EFdvF55ZL/3txz7wDsSLJvxkAnTkDRbc26W+v7yyolW0VxUMe5dtmr4E/j6rkcewE8/WGbgE0E+Ybgw2LyM=
  # LDAP_PORT
  - secure: LcyCDoPn2h4vQ6NcfeT0ur05Sd4j9Od28xow8A1p7n9GULsA8xsYsr5QKjsOc37xO1LJKnA840OHxEZHIB5234I0eboFGW7s7lEgfETrdgRNc2X2lpF6xl4OAqVsVTsVPKP9D4JDIl00/OlCeT5QK47ZaD4jDQM3Gl4PDO1639BNk2Ozjk3xqzRvoWQoZn6PQpc27tZrelFoKCYro0sx1oe039whsHEyU/xNl8YCkNdLi6lJEzSogULrcza0Thj7hVUMPkIaTTCqDz9JNcyy4xgvh11GEEMi0RfwDh/SA3EDuvvoQ8aHknI5R/CR/vuMdAjOGwtVLSIxVXuXU5yG1cgavEkVIbcBXQI55uvjeG8mgt0Y+DEPVc3le9FPx730OX4H3UopEigf1EOjIboH8FoCnP4ERRGC3TCkqEaqI0uK9Uahd6cZktGiK3cE/yQAt8GCEMID9uTX64clV4QBsRXnp0XRm9XS9+jFf4VMxOCDBeo+bwxHuk2/I+E5mJYtkpConAYVg5C/Zr79TT81JIszi2+2orTfNYMBreWbHrcGkT3eaWxQ28s+RbOsickkKy7wjH7k4ly0DNwCn9U3ckki1lUUOgJP4WY38escBAYRdswMzi2btaBPuop3PWki6QPp1UmTqGYJ0Vfg4l61nXTL8cqrlQMholVjRqG4Nwo=
jobs:
  include:
    - stage: test
      script: ".travis/01-test.sh"
    - stage: build
      script: ".travis/02-build-and-push-image.sh"
      if: (branch = develop) AND (NOT (type = pull_request))
    - stage: deploy
      script: ".travis/03-deploy.sh staging"
      if: (branch = develop) AND (NOT (type = pull_request))