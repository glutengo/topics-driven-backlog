language: generic
sudo: required
services:
- docker
addons:
  ssh_known_hosts:
  - backlog-staging.f4.htw-berlin.de
  - 141.45.146.76
env:
  global:
  - APPLICATION_ENVIRONMENT=docker
  # DOCKER_USERNAME
  - secure: wNNrboqc75TZuEnL0JfLzMaApL9V/ul4c4zig3goR9+8Ud0feGmF5wNNVWg58IsVw+QOVp0Vt50Q877VdWWxialft2JP6TMorIjBNhQ3+mBx2K5FdG+VBYWPLXBbIplJTG/3tfD6hvi1xl0J8VGQiVIOhkqK0BGPDZ/iK20tBW/R3r9wkgvqzg4otBeRFYqW6A2No5f1jzHAZ+DtJnwOSFZ4Lzp4gsIov7/+VSOi9gux4X8W3MsvKwIftMP0IT2qYqNVTWjmTVXQc5Zj5lPIQqcb5mC1iytQhkoTtpYBgclYd4tsRvbjgDOM5sA1+vqlOgYeXy2Uc6/3js6AE6DB6QFeuTGvol/sG9H82OYZMAt8aMkDL97MUtbaDJyBQnsoxG4aaoQLaSBFx/CR0o1Zr40yifcHQZHyygDklxiLAEW5RrG2uaMTWc999TmvEFmr5QBSfuUhAzWsKRmnZJ/kjo/NDTy6/rKyhc1mCaxJNHU51CdciFNP9seA3rJbcAjyDIJTCbs8e2nwzybiKWjHoTDnMjOJhV5e5OcynGaUmkSQABMyvzPtzTm2AlV6+cK4t9LgEsHZdWf8/VNcA+ITA00MfnX3/t9v4+DHC6t3SQFT5dC89QXDW2tFPZbnWzJtxPcjSGxFUWt11o9LSFigyUrJ9Co7INiEhxtGoxQslss=
  # DOCKER_PASSWORD
  - secure: jwc4wbqo6T8vqS+5T+qNxYLIulqVtp+4sotALcbSTT6vDGupfBqnzJ43dRaqmOL+HB+yEMxBOky2MofLFXN2fG/61I4QNlorfojAvDTLQXhJw+sX1LgO3Hs4mr4EChSXI/r4R+ZuP0a/fm+lrEXw7C+DrJEMWkj+K4J4Dcz1b+f/JLvr3iwNN/Xb9GuzDygT7z15Ir+XU9lch/fHXFNtkRmIHVtsPLIXxhj4173W2kaaS/E9NQNW6MBKtVUvP+l9InkbRAEeWoRyS3lLXznsKWYoBhhN/U4t5k6Ry9CJonkncjUyZGOu9KVCCT6+B62qfPFJVP9A+cy3dR+zlzI9lxqnhlB3STJSGaw62IzbOeHItuYSObG0lwDxyQ9jR75yXk1feikRsmeDIS+IfQSQq8y8bzcMzYONpztc/uuKy/Lqg8ISO9kSYCVzwBuNcbWzRE1nhpzN4GH4SlNWDfG8KvCWCWYtd0JK9gJ4tcC5SaTNQE8ISYUOJbfybGuLggfTru4PPIkNOGynShWZRy9fgDQGkMYmwlh5Cg5fyykaxzL5Qo9Xv4NVtCtizJKKe3cDGQSstdQcodbPKROgFzRzdGiCT50PgPSdILAkI4vLai+7bwPzlEEBpRCTA+GxWLqVzi7Y0IihID5A2WSwhruQthdMD/HCJHWvxYURljHYaGA=
  # SECRET_KEY_BASE
  - secure: Budja+a5FFjIfLeX0cZ4dMkze+yhN3t/L4lYNQFfA5zgrpknEGwOpoMc4j89JxzwrrERSB53yLTUWukQ8q7XmlmpG8xG9ye3a86tu0z+GMiYlT3jy+T9xCu7BNkNX9WGUyFgvycGuePX5rdDxfAAKiXjAcppYWDktBp50lXIPewJtnCZQh8MVpWB4efHo87W5dUjve2y39isiTBaRobszfIcZDe7Ql6aH/F1lxs00pciEAYj+rFzAUjGTnMyTb93S6IVT+Svi2ELzSYHNmybrfeAGQWQiEeZHQDN48ot6InjTUD/ZbmZRB7PRBKjxa1oYKtK7EheeK7P4HA5nB4aliAu62k/iNNIob3r7IT+YokVym+DUVoTQ16M5ialVhntkC1Y9/STYgUrfKr47oUGQodvuQeBLUoMbbR2stccDr6AEaqYO2DkDFTgy27Bal5N6l0ykCDYKqmI6l7V7xW0YMtDUkSKq1biMRlu0Hqo657DMk8u3TUz8cDAEJUlw0cZhW58+z4amFRHBnVU4UFd1TxHxUAaQRPkBhybOcdhxKRI5sC6YEJfuzkgiDlTn4ZCzd5Mu8iBBmEjzyBPV1BAVbAQKsIC3LDK1A5ovajy+bzKtKoE8lLeP9/bP+LJwdbEvzfcNuU9qeY9dkfhQ9EkaSrl/IgdqaQA8ryJeYlwvjA=
  # LDAP_HTW_CONNECTSTRING
  - secure: qavzj6J/BSr4SGL9RZ5KLKL1rYOkSS1lc/j8zhwIH13k7r6nO25vGNOLLzkhsPKRtKazL7b0XClEdyfXy9HI/aK2hQl1uSU2DIU3fKQLtnJzmMSFtGvumC+fTF8lkiRQE/kt7mTLVAqnzSnMi74OofveX3UxXfypVHnsndK3ift4/ZpTMaIrVIDrH3XWu23GTlptGAo/MGXOJ6VTVKse0qR332kFZBLGGCvviMyv3q9NBYKmVpZHqCVf5rJhzajyOYMewnkSAsQNA3HF3yH1/z2xlgdpBD78zxpuWyQv+SozUkF+aafAukNt+F5HTxRfKQRLUw4jqF1jrVLaRawkAO0+ljqGinwn6mImWkwtjqcW3MNgn5DroQOYy32ACR/jGbFJ7JJ09n6wG/kih8FAtk7Qb3lVJiy7BuFEgvbcwwf6MGzBCir99DG9Ux9sherEAiGAQIsh7USzRysPKJpYQuQNL8u2eJR831r/xWtW8WS7u2IH67qgTUaVuPMPObFiXuhUrLntN5fExK2J2uR11992YnzN22y7l/RonhFVeyin4Ir8DCeT1UV3Dz3/7chAj8R7QLeB82p5BjDoXo4HuvpGZWjNkCjuSerScpJALr5fjlyceU6zu2IS/3BYNPxMFm940rvxx9bQ1ZCfTkn0FNyPaYfcTI574DkTRpBVuO8=
  # LDAP_HTW_HOST
  - secure: XDPLZYdH/jSNNyP/prF8/fyhTaVcj+wBIGUdwN3TmSykTuoIyWIk/t9ke9xD7sRa/+IHOoB9ZIoAxrKrL5Tmyd2nVZPa2DbzYqQUoMCHLHiHSFGS1MieXKs6svKBKNdTYTiLDiCW+W2OofRiIFH7ArNLlowoFfn8HNATCuGohln4eMP09tFv2qwJPAUli3Du2Ua/o6Y9ha2du4Uo2Gapa0cOj9aDkUq/2SarhQAz+TOyJ+af3yytC2Wg0SpKxOE9tphEQQfiWFYhp9oZwytu8qh4zZJ7CyHDwFILYznx6TfbBUTbEOBibCJPxBh3jnJnGJxoWUc2wi4f3edaAOton2/FVMV82guNRBFPYJqlR8+1Cre1zN/h8SMUaCnxWmp+TV1JO5cKzpOjHNle2r71y6JSW6ZEsnUVYwkaENux/JV7yNzHFDeArl155BbFp45jWCNxlul5nyfuibw/dZKuhzGeFtPCYU2ii6/QKDXU/oHnZxak7wtFc4M0oo1Lo7dyyQKr9+F0wJ9ncC8dOHYOfDZ7u8SFKg2hRqb5d90lleqiL1ahSugt84i9y5o6qICQ6iu4rxGcluzQR+s0XsKHVMZdgf3i0JRrKMRiok5XvVBFRDjIqSS6/E14Z8RjJkCGJigquSQytRn+/8IZ4AGYlPLKhevl2zDJVNE9Q5nPDg4=
  # LDAP_HTW_PORT
  - secure: Osh2wgzssyqiqmcjv1jZDYzCPt+udSRNxCAqE72amOwaoPpqy0wdiAHvkPeQeM9aFGkXD6i0h90V8GvsF2c1yHutJcZI+FeZg408GTM2ueb0cToZAmMisDg9KoKyKxVAuY/mDLUF6IvZfnjestgWvWyevSbZj1kmvdadGU4Q5zJPgBSz2GfNFB/RywQpRNJIC4q1tTHkYw736UY4nmybNLinxLHHN9qNv+sjglPqKXMQzALz/1k1PQzftFvOaqcSFgTtJIMOEO2v2bdye8GmnDcmOCQeuPdPldpFgFXHY8hm5kUXCO6+LrF6Tmt7EBTTxY2zja+RlgU3S8ydMGzKBSLJ3SkAM59kkgImHmc4J9OOZg5R6yMT5LD2kH98bJa3vvDNvc1kY21jWFJ2+UK3v8foqrpW9xOF8U4L74BPXhvk5pmqjhca3uScjkdR9IJ0va6e0yhzARw4U0rwxSKZDLzIzEqWl8rXEBarbbiSTcEyxelujHzUETD4Nkp3LhJmWCzBHHVdBn/Ayz1faJZmKFAddt4IjPNWDnGlsQgKLqdm/a6A3URpZL54MS9L3e6KSz/5EHl9vMrUzwja8Dw50/tCa679vcjEn8AnFmLSKQWpKW9yxaPYveG/HDY3UlcZ4UWASKuenjWpQeb2qZ8PHjI3aRjmPegSaUE6ySzs2Nk=
jobs:
  include:
    - stage: test
      script: ".travis/01-test.sh"
    - stage: build
      script: ".travis/02-build-and-push-image.sh"
      if: (branch = develop) AND (NOT (type = pull_request))
    - stage: deploy
      script: ".travis/03-deploy.sh staging"
      if: (branch = develop) AND (NOT (type = pull_request))